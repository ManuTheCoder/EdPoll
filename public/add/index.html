<!DOCTYPE html>
<html>
  <head>
    <title>Create</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src=https://cdn.socket.io/3.1.3/socket.io.min.js integrity=sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh crossorigin=anonymous></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@materializecss/materialize@1.1.0-alpha/dist/css/materialize.min.css">
		<style>
			:root {--bg-color: #fff;--navbar-color:#000}
	#present {
		position: fixed;
		top: 0 !important;
		left: 0 !important;
		width: 100vw !important;
		height: 100vh !important;
		max-height: 100vh !important;
		min-height: 100vh !important;
	}
	input:focus + label,textarea:focus + label {color: #000 !important}
	textarea {margin-left: 0 !important}
      * {
        box-sizing: border-box;
      }
      .option {
        padding: 0 10px!important;
        line-height: 50px!important;
        max-height: unset !important;
        height: auto !important;
        outline: 0;
        display: block;
        border-radius: 4px !important;
        border: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
        box-shadow: 0 0 10px #ddd !important;
        margin-bottom: 10px;
      }
      .option:focus {
        box-shadow: 0 0 10px #ccc !important;
      }
      .waves-ripple {
        transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s !important;
      }
      .waves-effect:not(.waves-light, ._darkTheme .waves-effect) .waves-ripple {
        background: rgba(0, 0, 0, 0.2) !important;
      }
      ._darkTheme .waves-ripple { background: rgba(255, 255, 255, 0.2) !important; }
      .waves-light .waves-ripple { background: rgba(255, 255, 255, 0.2) !important; }


      nav {
        z-index: 9999999;
        box-shadow: none !important;
        background: rgba(200, 200, 200, 0.2) !important;
        backdrop-filter: blur(10px);

        /* border-bottom: 1px solid #505050; */

        position: fixed;
        top: 0;
        left: 0;
      }
      body {
        padding-top: 130px;
      }


      nav a, .tabs .tab a{
        color: #000 !important;
        background: transparent !important;

      }

      /* Black color to the text */

      .tabs .indicator {
        background-color: #505050 !important;
      }

      /* Color of underline */

      .collapsible {
        box-shadow: none !important;
        border: 0 !important;
      }

      .modal {z-index: 999999999999999999999999999999999999999999999999 !important}

      @media only screen and (min-width: 992px) {
        .bottom-sheet {
          width: 50% !important;
          margin: auto !important
        }
      }

      .bottom-sheet {max-height: 90vh !mportant;height: 90vh !important;min-height: 90vh !important}

      #c2 .chip {
        display: block;
        border-radius: 4px;
        padding: 10px 15px;
        height: auto;
      }
      .chip:focus {
        background: #37474f !important
      }

			.input-field {
  max-width: 100%;
  overflow: visible !important
}
.input-border input,.input-border textarea {
  border: 1px solid #aaa !important;
  border-radius: 3px !important;
  padding-left: 10px !important;
  width: 100%;
  display: block;
  max-width: 100%;

  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}
.suggestions {overflow-x: scroll; white-space: nowrap;overflow-y: visible}
::-webkit-scrollbar {display:none}
.suggestions .card {width: 300px;margin: 10px;}
._darkTheme .input-border label {background:var(--bg-color)!important}
.input-border input:hover,.input-border textarea:hover {
  border: 1px solid #303030 !important;
}
.input-border label,.input-border textarea {
  margin-left: 10px !important;
  background: white;
  transition: all .2s !important;
  padding: 0 4px;
  display: inline-block;
}
label {pointer-events:none}
.input-border input:focus,.input-border textarea:focus {
  border-color: var(--navbar-color) !important;
  box-shadow: 0px 0px 0px 1px var(--navbar-color) inset !important;
}
._darkTheme .input-border input:focus,._darkTheme .input-border textarea:focus {
  border-color: var(--font-color) !important;
  box-shadow: 0px 0px 0px 1px var(--font-color) inset !important;
}
.input-border .input-field input:focus + label.active,.input-border .input-field textarea:focus + label.active {
  color: var(--navbar-color) !important;
}
.input-border label.active {
  margin-left: 7px !important;
  margin-top: 8px !important
}
    </style>
  </head>
  <body>
<div class="modal" id="present">
	Test
</div>
    <nav class="nav-extended">
      <div class="nav-wrapper">
        <ul id="nav-mobile" class="">
          <li><a href="/">EdPoll</a></li>
        </ul>
        <ul class="right">
          <li><a href="/add">Create</a></li>
        </ul>
      </div>
      <div class="nav-content">
        <ul class="tabs tabs-fixed-width tabs-transparent"> 
          <li class="tab col s3"><a href="#p1" class="waves-effect">Poll</a></li>
          <!-- <li class="tab col s3"><a href="#p1" class="waves-effect">Poll</a></li> -->
          <li class="tab col s3"><a href="#p2" class="waves-effect">Wordcloud</a></li>
        </ul>
      </div>
    </nav>
    <div class="modal bottom-sheet" id="selectFile">
      <div class="modal-content">
        <h5>
          <b>Select File</b>
        </h5>
        <br>
        <h6>
          Upload a file...
        </h6>
        <br>
        <input autocomplete="off" type="file" oninput="fileChange(this, function(e){document.getElementById('url__i').value=(e);})" accept="image/*">
        <br><br><div class="divider">

        </div><br>
        <h6>
          ... or paste URL here
        </h6>
        <div class="input-field input-border">
          <label>Paste URL here...</label>
          <input autocomplete="off" id="url__i" type="text">
        </div>

        <a class="btn btn-round blue darken-3 waves-effect waves-light ">Continue <i class="material-icons right">arrow_forward</i></a>
      </div>
    </div>
    <div class="container" id='app'>
      <div id="p1" class="col s12">
        <!-- <form id="pollForm"> -->
					<div class="suggestions">
						<div class="card hoverable waves-effect" onclick="suggest(this)">
							<div class="card-content">
								<p><b>Presentation feedback</b></p>
							</div>
						</div>
						<div class="card hoverable waves-effect" onclick="suggest(this)">
							<div class="card-content">
								<p><b>Leaderboard</b></p>
							</div>
						</div>
						<div class="card hoverable waves-effect" onclick="suggest(this)">
							<div class="card-content">
								<p><b>Assign Team</b></p>
							</div>
						</div>
					</div>
          <h5>
            <b>Create</b>
          </h5>
          <div class="input-field input-border">
            <input autocomplete="off" type="text" id="poll__name">
            <label>Poll Title</label>
          </div>
					<div id="c2container">
          	<div class="chips" id="c2"></div>
					</div>
					<!-- Remove the `hide` class if you want this to be shown -->
          <div class="row grey lighten-3 hide" style='padding:10px;border-radius:4px;'>
            <div class="col s12">
              <h6>
                Add file
              </h6>
            </div>
            <div class="col s6 input-field input-border">
              <input autocomplete="off" id="alt" type="text">
              <label style="background:#eee!important;">Text</label>
            </div>
            <div class="col s6">
              <input autocomplete="off" type="file" oninput="fileChange(this, function(e){uploadImage(e,document.getElementById('alt').value)})" accept="image/*">
            </div>
          </div>
          <ul class="collapsible">
            <li>
              <div class="collapsible-header waves-effect"><i class="material-icons">more_horiz</i>More</div>
              <div class="collapsible-body">
                <div class="chips" id="c1"></div>
											    <p>
					<label>
						<input type="checkbox" id="poll__hideChat" />
						<span>Hide chat?</span>
					</label>
				</p>
                <div class="input-field input-border">
                  <label>Poll Description</label>
                  <textarea class="materialize-textarea" id="poll__description" style="min-height: 100px;margin-left:0 !important"></textarea>
                </div>
                <div class="input-field input-border">
                  <label>Poll Password</label>
                  <input autocomplete="off" type="password" id="poll__password">
                </div>

                <div class="input-field input-border">
                  <label>Poll header image</label>
                  <input autocomplete="off" type="url" id="poll__image" class="validate">
                </div>
              </div>
            </li>
          </ul>

          <input autocomplete="off" type="hidden" id="categories">
          <button class="btn blue-grey waves-effect waves-light darken-3" id="submitBTN">
            Create
          </button>
        <!-- </form> -->

      </div>
      <div id="p2" class="col s12">
				<h5><b>Create wordcloud</b></h5>
        <!-- Coming soon! -->
				<div class="input-field input-border">
					<input autocomplete="off" type="text" id="wc__name">
					<label>Title</label>
				</div>
				<div class="input-field input-border">
					<textarea type="text" id="wc__description" class="materialize-textarea" style="margin-left:0 !important"></textarea>
					<label>Description (optional)</label>
				</div>
				<div class="input-field input-border">
					<input autocomplete="off" type="text" id="wc__image">
					<label>Image (optional)</label>
				</div>
				<div class="input-field input-border">
					<input autocomplete="off" type="password" id="wc__password">
					<label>Password (optional)</label>
				</div>
				    <p>
					<label>
						<input type="checkbox" id="wc__hideChat" />
						<span>Hide chat?</span>
					</label>
				</p>
				<button id="addWordcloud" class="btn blue-grey darken-3 waves-effect waves-light"><i class="material-icons left">add</i>Create</button>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@materializecss/materialize@1.1.0-alpha/dist/js/materialize.min.js"></script>
    <script>
      var categories = [];
      var id = 0;
      var choices = [];
      var socket = io();

      $(".tabs").tabs();
      $('.collapsible').collapsible()
      $('.modal').modal();

      var elems = document.querySelectorAll('#c1');
      var instances = M.Chips.init(elems, {
        // specify options here
        placeholder: "Categories...",
        onChipAdd() {
          var instance = M.Chips.getInstance(document.querySelector("#c1"));
          categories = [];
          instance.chipsData.forEach(e=>categories.push(e.tag))
        },
        onChipDelete() {
          var instance = M.Chips.getInstance(document.querySelector("#c1"));
          categories = [];
          instance.chipsData.forEach(e=>categories.push(e.tag))
        }
      });

      var instances = M.Chips.init(document.getElementById('c2'), {
        // specify options here
        placeholder: "Poll answers",
        onChipAdd() {
          var instance = M.Chips.getInstance(document.querySelector("#c2"));
          choices = [];
          instance.chipsData.forEach(e=>choices.push(e))
          var i;
          for(i = 0; i < choices.length; i++){
            if(choices[i]['tag']) {
              choices[i].name = choices[i]['tag'];
              delete choices[i]['tag']
            }
            choices[i].votes = 0;
          }

          console.log(choices)
        },
        onChipDelete() {
          var instance = M.Chips.getInstance(document.querySelector("#c2"));
          choices = [];
          instance.chipsData.forEach(e=>choices.push(e))
          var i;
          for(i = 0; i < choices.length; i++){
            if(choices[i]['tag']) {
              choices[i].name = choices[i]['tag'];
              delete choices[i]['tag']
            }
            choices[i].votes = 0;
          }

          console.log(choices)
        }
      });


      function fileChange(el, callback = function (e) { }) {
        var file = el;
        var form = new FormData();
        form.append("image", file.files[0])

        var settings = {
          "url": "https://api.imgbb.com/1/upload?key=5e97a7dae2b850713c9da081460622cf",
          "method": "POST",
          "timeout": 0,
          "processData": false,
          "mimeType": "multipart/form-data",
          "contentType": false,
          "data": form
        };


        $.ajax(settings).done(function (response) {
          console.log(response);
          var jx = JSON.parse(response);
          callback(jx.data.url)

        });
      }
      function uploadImage(d,t) {
        var dd = M.Chips.getInstance(document.querySelector("#c2"));
        dd.addChip({ tag: t, image: d});
      }

      $("#submitBTN").click( e => {
        // e.preventDefault();
        var form = $(this);
        var url = form.attr('action');
        var data = {
          type: "Poll",
          title: document.getElementById('poll__name').value,
          categories: categories,
          desc: document.getElementById('poll__description').value,
					hideChat: (document.getElementById("poll__hideChat").checked?true:false),
          pwd: document.getElementById('poll__password').value,
          options: choices,
          image: document.getElementById('poll__image').value,
          date: `${new Date().getMonth()}/${new Date().getDate()}/${new Date().getFullYear()} at ${new Date().getHours()}:${new Date().getMinutes()}`,
        };

        console.log(data)

        socket.emit("addPoll", data)
        socket.on("newPollAdded", (e)=> {
          id = e;
					history.pushState(null,null,`https://${window.location.hostname}/j/${e}`)
          $("#app").load("https://www.edpoll.ga/add/view.html");
					$(".nav-content *").addClass("hide")
        })
      });
			if(window.location.href.includes("/j/")) {
				id = window.location.href.replace(/\D/g,'');
				$("#app").load("https://www.edpoll.ga/add/view.html");
				$(".nav-content *").addClass("hide")
			}
			$(".modal").modal();

			$("#addWordcloud").click(() => {
				var data = {
          type: "Wordcloud",
          title: document.getElementById('wc__name').value,
          desc: document.getElementById('wc__description').value,
          pwd: document.getElementById('wc__password').value,
					hideChat: (document.getElementById("wc__hideChat").checked?true:false),
					responses: [],
          image: document.getElementById('wc__image').value,
          date: `${new Date().getMonth()}/${new Date().getDate()}/${new Date().getFullYear()} at ${new Date().getHours()}:${new Date().getMinutes()}`,
        }
				socket.on("newPollAdded", (e)=> {
          id = e;
					history.pushState(null,null,`https://${window.location.hostname}/j/${e}`)
          $("#app").load("https://www.edpoll.ga/add/view.html");
					$(".nav-content *").addClass("hide")
        })
				socket.emit("addPoll", data);
			})
			function suggest(el) {
				var name;
				switch(el.innerText.toLowerCase()) {
					case "presentation feedback": 
						name = "How would you rate the presentation?"
						break;
					case "leaderboard": 
						name = "Vote for the person you want"
						break;
					case "assign team": 
						name = "What team are you on?"
						break;
				}
				document.getElementById("poll__name").value = name;
				document.getElementById("poll__name").focus()
			}
    </script>
  </body>
</html>